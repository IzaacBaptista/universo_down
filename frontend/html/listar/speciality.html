<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Listagem de Especialidades</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/frontend/public/css/bootstrap.min.css" />

    <!-- CSS -->
    <link rel="stylesheet" href="/frontend/public/css/navbar.css" />
    <link rel="stylesheet" href="/frontend/public/css/style.css" />
  </head>
  <body>
    <div class="wrapper">
      <!-- Sidebar  -->
      <nav id="sidebar">
        <div id="nav-placeholder"></div>
      </nav>
      <!-- Conteúdo da Página  -->
      <div id="content">
        <div class="card col-12">
          <h3 class="mt-4 ml-2" style="text-align: center">
            Lista de Especialidades
          </h3>
          <div class="card-body">
            <div class="container">
              <hr size="4" />
              <p>Digite o nome da Especialidade para Pesquisar</p>
              <input
                class="col-4"
                id="inputSearch"
                type="text"
                placeholder="Digitar.."
              />
              <hr size="4" />
              <div class="row row-cols-12">
                <table id="specialityTable" class="display">
                  <thead class="col-12">
                    <tr>
                      <th class="col-2">Registro</th>
                      <th class="col-7">Especialidade</th>
                      <th class="col-7">Opções</th>
                    </tr>
                  </thead>
                </table>
              </div>
              <hr size="4" />
            </div>
          </div>
        </div>
      </div>
    </div>
 <!-- JS -->
    <script src="/frontend/public/js/dist/jquery-3.6.0.min.js"></script>
    <script src="/frontend/public/js/script.js"></script>
    <script type="Module" src="/frontend/public/js/fns/erroHandler.js"></script>
     <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" />
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script>

    var baseUrlApi = "http://localhost:3000/api/v1";
    $(document).ready(function () {
      var data = {};
      $.ajax({
        type: "GET",
        url: baseUrlApi + "/speciality",
        headers: {
          "x-access-token": localStorage.getItem("Authorization"),
        },
        dataType: "JSON",
        success: function (data) {
          var table = $("#specialityTable").DataTable({
            columnDefs: [
              {
                targets: 2,
                render: function (data, type, row, meta) {
                  return (
                    '<input type="button" class="btn btn-primary " id=n-"' +
                    meta.row +
                    '" value="Editar"/><input type="button" class="btn btn-danger" id=btnExcluir"' +
                    meta.row +
                    '" value="Deletar"/>'
                  );
                },
              },
            ],
            data: data,
            columns: [{ data: "id" }, { data: "name" }],
          });
        },
        error: function (err) {
          alert("erro" + JSON.stringify(err));
        },
      });
      $("#specialityTable").on("click", ".btn-primary", function () {
        var id = $(this).attr("id").match(/\d+/)[0];
        var data = $("#specialityTable").DataTable().row(id).data();
        alert("ID " + data.id)
      });
   
        $("#specialityTable").on("click", ".btn-danger", function () {
        var id = $(this).attr("id").match(/\d+/)[0];
        var data = $("#specialityTable").DataTable().row(id).data();
          console.log("DATA ID " + data.id)
          var id2 = data.id;
          
          var confirmalert = confirm("Você tem certeza?");
          if (confirmalert === true) {
            $.ajax({
              headers: {
                "x-access-token": localStorage.getItem("Authorization"),
              },
              url: "http://localhost:3000/api/v1/speciality/" + id2,
              type: "DELETE",
              success: function (response) {
                if (response) {
                  alert("Especialidade Removida");
                  location.reload(true);
                }
              },
              error: function (err) {
               alert(err.status);
              },
            });
          }
        });
      });
    </script>
  </body>
</html>
